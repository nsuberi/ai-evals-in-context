{% extends "base.html" %}
{% from "components/code_canvas.html" import code_canvas %}
{% from "components/collapsible.html" import collapsible %}

{% block title %}Test Navigator - AI Testing Resource{% endblock %}

{% block content %}
<!-- AI Evaluation Educational Banner -->
<div class="ai-eval-banner">
  <h2 class="ai-eval-banner__title">
    <span class="ai-eval-banner__title-badge">AI</span>
    Understanding AI Evaluation vs Traditional Testing
  </h2>
  <div class="ai-eval-banner__grid">
    <div class="ai-eval-banner__concept">
      <div class="ai-eval-banner__concept-header">
        <span class="ai-eval-banner__concept-icon">üé≤</span>
        <span class="ai-eval-banner__concept-title">Unique to AI</span>
      </div>
      <p class="ai-eval-banner__concept-desc">AI tests are flaky by default; the same input can produce different outputs. This requires new approaches beyond traditional pass/fail testing.</p>
    </div>
    <div class="ai-eval-banner__concept">
      <div class="ai-eval-banner__concept-header">
        <span class="ai-eval-banner__concept-icon">üë§</span>
        <span class="ai-eval-banner__concept-title">Human in the Loop</span>
      </div>
      <p class="ai-eval-banner__concept-desc">SMEs validate what "good" means; automated tests catch regressions. Human judgment defines quality criteria.</p>
    </div>
    <div class="ai-eval-banner__concept">
      <div class="ai-eval-banner__concept-header">
        <span class="ai-eval-banner__concept-icon">‚öñÔ∏è</span>
        <span class="ai-eval-banner__concept-title">Business Owns Risk</span>
      </div>
      <p class="ai-eval-banner__concept-desc">Business defines acceptable thresholds and owns risk decisions. 95% accuracy may be fine for suggestions, not for medical advice.</p>
    </div>
    <div class="ai-eval-banner__concept">
      <div class="ai-eval-banner__concept-header">
        <span class="ai-eval-banner__concept-icon">üîÑ</span>
        <span class="ai-eval-banner__concept-title">Continuous Improvement</span>
      </div>
      <p class="ai-eval-banner__concept-desc">Deploy, observe, annotate, improve, repeat. AI systems require ongoing evaluation and refinement cycles.</p>
    </div>
  </div>
</div>

<div class="layout layout--sidebar">
  <!-- Sidebar: AI Acceptance Tests, Test Types, and Tests -->
  <aside>
    <!-- AI Acceptance Testing Section -->
    {% if ai_acceptance_tests %}
    <div style="margin-bottom: var(--space-lg);">
      <h3 class="sidebar-section-header sidebar-section-header--ai">
        Acceptance Testing AI Features
        <span class="sidebar-section-badge">AI</span>
      </h3>
      <div class="sidebar">
        {% for test in ai_acceptance_tests %}
        <a href="{{ url_for('viewer.test_navigator', test_type='ai_acceptance', test=test.id) }}"
           class="sidebar__item sidebar__item--ai {% if test.id == selected_test %}sidebar__item--active{% endif %}">
          {{ test.name }}
        </a>
        {% endfor %}
      </div>
    </div>
    <div class="sidebar-section-divider"></div>
    {% endif %}

    <!-- Traditional Test Types -->
    <div style="margin-bottom: var(--space-lg);">
      <h3 class="sidebar-section-header">
        Test Types
        <span class="sidebar-tag">SDLC</span>
      </h3>
      <div class="sidebar">
        {% for type in test_types %}
        <a href="{{ url_for('viewer.test_navigator', test_type=type.id) }}"
           class="sidebar__item {% if type.id == current_type and current_type != 'ai_acceptance' %}sidebar__item--active{% endif %}">
          {{ type.name }}
        </a>
        {% endfor %}
      </div>
    </div>

    {% if tests %}
    <div>
      <h3 style="color: var(--color-chrome-text-bright); font-size: 0.875rem; margin: 0 0 var(--space-sm) 0;">
        {{ current_type | title }} Tests
      </h3>
      <div class="sidebar">
        {% for test in tests %}
        <a href="{{ url_for('viewer.test_navigator', test_type=current_type, test=test.id) }}"
           class="sidebar__item {% if test.id == selected_test %}sidebar__item--active{% endif %}">
          {{ test.name }}
        </a>
        {% endfor %}
      </div>
    </div>
    {% endif %}
  </aside>

  <!-- Main Content -->
  <div class="content-primary">
    <!-- Test Code Canvas (Primary - The Star) -->
    {% if test_code %}
    <div class="code-canvas" data-test-id="{{ selected_test }}">
      <div class="code-canvas__header">
        <span class="code-canvas__filename">{{ test_filename }}</span>
        <div style="display: flex; align-items: center; gap: 0.5rem;">
          <span class="code-canvas__badge">{{ current_type }}</span>
          <button class="run-button" onclick="runTest('{{ selected_test }}')">
            <span>&#9654;</span> Run
          </button>
        </div>
      </div>
      <pre class="code-canvas__code highlight"><code>{{ test_code | safe }}</code></pre>
    </div>
    {% else %}
    <div class="explanation">
      <p>Select a test from the sidebar to view its code.</p>
    </div>
    {% endif %}

    <!-- Secondary Content Row -->
    <div class="content-secondary">
      <!-- Related App Code (Secondary) -->
      {% if app_code %}
      <div class="code-canvas code-canvas--secondary">
        <div class="code-canvas__header">
          <span class="code-canvas__filename">{{ app_filename }}</span>
          <span class="code-canvas__badge" style="background: var(--color-info);">App Code</span>
        </div>
        <pre class="code-canvas__code highlight"><code>{{ app_code | safe }}</code></pre>
      </div>
      {% endif %}

      <!-- Explanation Panel -->
      <div class="explanation">
        <h3 class="explanation__title">{{ explanation.title }}</h3>
        <div class="explanation__content">
          {{ explanation.content | safe }}
        </div>
        {% if explanation.relationship_to_ai %}
        <div style="margin-top: var(--space-md); padding-top: var(--space-md); border-top: 1px solid rgba(255,255,255,0.1);">
          <strong style="color: var(--color-accent);">Relationship to AI:</strong>
          <p style="margin-top: var(--space-xs);">{{ explanation.relationship_to_ai | safe }}</p>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
